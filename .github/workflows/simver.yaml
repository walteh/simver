{
    name: simver,
    concurrency: { group: simver, cancel-in-progress: false },
    permissions: { id-token: write, contents: write, pull-requests: read },
    on: {
            workflow_dispatch: null,
            workflow_call: {},
            # push: { branches: [main] },
            # pull_request: { types: [opened, synchronize, reopened, closed] },
        },
    defaults: { run: { shell: bash } },
    jobs:
        {
            simver:
                {
                    runs-on: ubuntu-latest,
                    steps:
                        [
                            {
                                name: checkout code,
                                uses: "actions/checkout@v4",
                                with: { fetch-depth: 0 },
                            },
                            {
                                name: checkout code,
                                uses: "actions/checkout@v4",
                                with:
                                    {
                                        fetch-depth: 0,
                                        repository: "github.com/walteh/simver",
                                        ref: "{{ env.GITHUB_WORKFLOW_SHA }}",
                                        path: "__simver__",
                                    },
                            },
                            {
                                name: get current go version from go.mod,
                                id: go-version,
                                run: 'cat go.mod | grep ''go '' | awk ''{print $2}'' | xargs -I {} echo "GO_VERSION={}" >> $GITHUB_ENV',
                            },
                            {
                                name: setup golang,
                                uses: "actions/setup-go@v4",
                                with: { go-version: "{{ env.GO_VERSION }}" },
                            },
                            {
                                name: install dependencies,
                                run: "cd __simver__ && go mod download",
                            },
                            {
                                name: install simver,
                                env:
                                    {
                                        GITHUB_TOKEN: "${{ secrets.GITHUB_TOKEN }}",
                                    },
                                run: "go run ./__simver__/cmd/simver_gha --read-only=false",
                            },
                        ],
                },
        },
}
